
local startingPos = vector3(305.12406616211,4340.690703125,51.358632354736)

local cfg = {
    slots = {
        {268.79962158203,-1985.7272949219,20.413827896118,140},
        {427.27899169922,-1842.1076660156,28.463443756104,315},
        {168.85313415527,-1863.1490478516,24.205423355103,64},
        {236.10025024414,-2045.8663330078,18.379985809326,329},
        {165.25131225586,-1945.0799560547,20.235416412354,225},
        {149.1735534668,-1960.8555908203,19.458770751953,220},
        {109.2041015625,-2015.9682617188,18.406114578247,163},
        {118.46211242676,-1920.8854980469,21.323419570923,52},
        {105.35874176025,-1900.9675292969,21.406679153442,333},
        {105.03990936279,-1976.5155029297,20.964458465576,14},
        {-42.777168273926,-1859.3254394531,26.19730758667,139},
        {-3.3230361938477,-1821.1666259766,29.54323387146,232},
        {531.47595214844,-1769.5170898438,28.816122055054,356},
        {561.52954101562,-1747.7801513672,33.442638397217,157},
        {523.97515869141,-1966.0201416016,26.54633140564,305},
        {188.89622497559,-2019.1413574219,18.288768768311,262},
        {295.96255493164,-1714.8173828125,29.179161071777,223},
        {66.516288757324,-1868.6539306641,22.799407958984,315},
        {168.30490112305,-1708.4404296875,29.291677474976,316},
        {320.89599609375,-1732.3082275391,29.71498298645,49},
        {-1157.6446533203,-1518.0360107422,10.632730484009,218},
        {-1165.2664794922,-1567.009765625,4.4518995285034,304},
        {-1103.7145996094,-1600.1147460938,4.6708540916443,123},
        {-1062.5412597656,-1662.5628662109,4.5590515136719,121},
        {-1291.9291992188,-1609.4945068359,4.0965523719788,217},
        {-1132.1450195312,-1552.453125,4.3198938369751,117},
    },
    plants = {
        {position = {3479.3, 2558.06, 12.89}, grow = 1},
        {position = {3480.47, 2548.58, 10.63}, grow = 1},
        {position = {3484.48, 2552.67, 10.67}, grow = 1},
        {position = {3472.28, 2550.44, 11.68}, grow = 1},
        {position = {3473.02, 2545.5, 11.27}, grow = 1},
        {position = {3462.89, 2539.46, 10.32}, grow = 1},
        {position = {3461.52, 2547.22, 11.83}, grow = 1},
        {position = {3455.82, 2548.43, 12.2}, grow = 1},
        {position = {3455.55, 2556.2, 12.99}, grow = 1},
        {position = {3459.05, 2570.35, 14.72}, grow = 1},
        {position = {3467.45, 2572.54, 15.4}, grow = 1},
        {position = {3474.59, 2561.6, 14.23}, grow = 1},
        {position = {3478.88, 2563.12, 13.97}, grow = 1},
        {position = {3476.2, 2571.6, 14.92}, grow = 1},
        {position = {3470.55, 2575.45, 15.4}, grow = 1},
        {position = {3460.79, 2576.88, 15.6}, grow = 1},
        {position = {3457.35, 2575.61, 15.27}, grow = 1},
        {position = {3452.62, 2564.03, 13.37}, grow = 1},
        {position = {3443.04, 2563.32, 12.8}, grow = 1},
        {position = {3443.0, 2567.44, 12.73}, grow = 1},
        {position = {3446.27, 2569.1, 13.0}, grow = 1},
        {position = {3454.45, 2578.07, 15.52}, grow = 1},
        {position = {3455.91, 2583.94, 16.36}, grow = 1},
        {position = {3444.51, 2580.28, 13.87}, grow = 1},
        {position = {3444.83, 2576.71, 13.65}, grow = 1},
        {position = {3435.36, 2569.93, 12.04}, grow = 1},
        {position = {3433.68, 2575.81, 12.4}, grow = 1},
        {position = {3434.21, 2580.34, 12.75}, grow = 1},
        {position = {3436.24, 2584.9, 12.5}, grow = 1},
        {position = {3444.56, 2588.13, 13.41}, grow = 1},
        {position = {3445.02, 2585.09, 14.08}, grow = 1},
        {position = {3457.14, 2589.91, 17.02}, grow = 1},
        {position = {3454.77, 2593.36, 16.52}, grow = 1},
        {position = {3441.79, 2592.12, 11.69}, grow = 1},
        {position = {3444.99, 2599.48, 12.49}, grow = 1},
        {position = {3453.43, 2604.73, 14.58}, grow = 1},
        {position = {3456.55, 2602.48, 15.15}, grow = 1},
        {position = {3461.11, 2593.54, 17.53}, grow = 1},
        {position = {3461.34, 2583.34, 16.38}, grow = 1},
        {position = {3470.99, 2586.4, 16.03}, grow = 1},
        {position = {3474.41, 2587.27, 15.39}, grow = 1},
        {position = {3479.45, 2577.66, 14.59}, grow = 1},
        {position = {3480.21, 2570.24, 14.41}, grow = 1},
        {position = {3482.91, 2559.65, 12.64}, grow = 1},
        {position = {3485.5, 2557.94, 11.75}, grow = 1},
        {position = {3491.0, 2551.87, 9.71}, grow = 1},
        {position = {3491.03, 2558.97, 10.73}, grow = 1},
        {position = {3488.58, 2565.37, 12.44}, grow = 1},
        {position = {3486.18, 2567.97, 13.26}, grow = 1},
        {position = {3482.8, 2578.34, 14.23}, grow = 1},
        {position = {3485.41, 2584.08, 14.25}, grow = 1},
        {position = {3476.08, 2592.71, 14.55}, grow = 1},
        {position = {3472.58, 2592.5, 15.33}, grow = 1},
        {position = {3464.6, 2599.57, 16.17}, grow = 1},
        {position = {3471.15, 2597.71, 14.83}, grow = 1},
        {position = {3483.69, 2591.49, 13.5}, grow = 1},
        {position = {3486.97, 2588.65, 13.75}, grow = 1},
        {position = {3495.51, 2576.05, 12.32}, grow = 1},
        {position = {3493.28, 2569.68, 12.04}, grow = 1},
        {position = {3496.91, 2562.85, 10.63}, grow = 1},
        {position = {3500.19, 2562.71, 10.34}, grow = 1},
        {position = {3509.1, 2569.09, 9.81}, grow = 1},
        {position = {3505.46, 2584.63, 11.61}, grow = 1},
        {position = {3501.63, 2585.57, 12.78}, grow = 1},
        {position = {3508.31, 2590.62, 12.79}, grow = 1},
        {position = {3507.55, 2579.13, 9.91}, grow = 1},
        {position = {3499.8, 2570.08, 11.29}, grow = 1},
        {position = {3500.4, 2556.33, 8.49}, grow = 1},
        {position = {3506.64, 2564.59, 10.28}, grow = 1},
        {position = {3513.64, 2579.89, 9.8}, grow = 1},
        {position = {3515.1, 2586.22, 10.78}, grow = 1},
        {position = {3505.01, 2596.11, 13.21}, grow = 1},
        {position = {3495.91, 2593.67, 13.53}, grow = 1},
        {position = {3487.29, 2580.66, 13.87}, grow = 1},
        {position = {3485.2, 2584.44, 14.26}, grow = 1},
        {position = {3486.05, 2594.42, 13.02}, grow = 1},
        {position = {3478.53, 2590.51, 14.41}, grow = 1},
        {position = {3468.58, 2593.16, 16.48}, grow = 1},
        {position = {3477.77, 2601.09, 12.44}, grow = 1},
        {position = {3472.06, 2606.79, 12.81}, grow = 1},
        {position = {3465.34, 2597.44, 16.62}, grow = 1},
        {position = {3462.41, 2594.98, 17.43}, grow = 1},
        {position = {3456.08, 2605.92, 14.82}, grow = 1},
        {position = {3453.63, 2598.89, 15.31}, grow = 1},
        {position = {3449.18, 2595.4, 14.39}, grow = 1},
        {position = {3438.29, 2605.55, 11.19}, grow = 1},
        {position = {3431.52, 2594.46, 10.55}, grow = 1},
    }
}

local possibleModels = {
    "u_m_m_aldinapoli",
    "u_m_m_bikehire_01",
    "u_m_y_smugmech_01",
    "u_m_y_proldriver_01",
    "u_m_m_streetart_01",
    "u_m_o_tramp_01",
    "u_m_y_dancelthr_01",
    "u_m_y_hippie_01",
    "u_m_y_militarybum",
    "a_m_m_rurmeth_01",
    "a_m_m_salton_03",
    "a_m_o_soucent_02",
}

local function drawText(text, x, y, scale, r, g, b)
	SetTextFont(0)
	SetTextCentre(1)
	SetTextProportional(0)
	SetTextScale(scale, scale)
	SetTextDropShadow(30, 5, 5, 5, 255)
	SetTextEntry("STRING")
	SetTextColour(r, g, b, 255)
	AddTextComponentString(text)
	DrawText(x, y)
end

local theJob = {}

Citizen.CreateThread(function()

    local pedId = vRP.spawnNpc("OpiumStarter", {
        position = startingPos,
        rotation = 79,
        model = "u_m_m_blane",
        freeze = true,
        scenario = {anim = {dict = "timetable@maid@couch@", name = "base"}},
        minDist = 2.5,
        name = "Gicu Lovele",
        ["function"] = function()
            SendNUIMessage({job = "opium", group = inJob})
        end
    })

    table.insert(allJobPeds, "OpiumStarter")

end)


local gameFinish
RegisterNUICallback("opium:gameDone", function(data, cb)
    if type(gameFinish) == "function" then
        gameFinish(data[1])
    end
    gameFinish = false
    
    cb("ok")
end)

local blips, objs = {}, {}

RegisterNetEvent("work-opiumtrafficker:startJob", function(cpData)
    if inJob == "Traficant de opium" then
        local jobActive = true
        local evt
        evt = AddEventHandler("jobs:onJustFired", function()
            Citizen.Wait(100)
            if not inJob and jobActive then
                jobActive = false
                theJob = {}
            end

            RemoveEventHandler(evt)
        end)

        if not next(theJob) then
            theJob = {
                plants = cfg.plants,
            }
        end
        
        if not theJob.amount then
            triggerCallback("getOpiumToDelivery", function(amm)
                theJob.slot = math.random(1, #cfg.slots)
                theJob.amount = tonumber(amm)
            end)
            Citizen.Wait(1000)
            TriggerServerEvent("jobs:updateLastJob", theJob)
        end
        Citizen.CreateThread(function()
            Citizen.Wait(1500)
            vRP.subtitle("Un dependent de droguri vrea sa cumpere ~HC_216~"..theJob.amount.." Opium~w~, vezi harta pentru locatie.", 8)
        end)


        Citizen.CreateThread(function()

            local function getdist(x1, x2, y1, y2)
                return math.sqrt((y2-y1)*(y2-y1) + (x2-x1)*(x2-x1))
            end

            local function deepcopy(orig)
                local orig_type = type(orig)
                local copy
                if orig_type == 'table' then
                    copy = {}
                    for orig_key, orig_value in next, orig, nil do
                        copy[deepcopy(orig_key)] = deepcopy(orig_value)
                    end
                    setmetatable(copy, deepcopy(getmetatable(orig)))
                else -- number, string, boolean, etc
                    copy = orig
                end
                return copy
            end

            local npcWaiting = true
            while jobActive do
                local ped = PlayerPedId()
                local pedPos = GetEntityCoords(ped)
                
                if theJob.slot and theJob.amount then
                    local x, y, z, h = table.unpack(cfg.slots[theJob.slot])
                    
                    local blip = AddBlipForRadius(x, y, z, 100.0)
                    SetBlipColour(blip, 5)
                    SetBlipAlpha(blip, 150)
                    table.insert(blips, blip)

                    local model = possibleModels[math.random(1, #possibleModels)]
                    RequestModel(model)
                    while not HasModelLoaded(model) do
                        Wait(1)
                    end
                
                    local ped = CreatePed(0, model, x, y, z - 1.0, h + 0.0, false, true)
                    FreezeEntityPosition(ped, true)
                    SetEntityInvincible(ped, true)
                    SetBlockingOfNonTemporaryEvents(ped, true)
                    TaskStartScenarioInPlace(ped, "WORLD_HUMAN_DRUG_DEALER_HARD", 0, true)
                    SetModelAsNoLongerNeeded(model)
                    table.insert(objs, ped)

                    local npcPos = GetEntityCoords(ped)
                    
                    while npcWaiting do
                        local ped = PlayerPedId()
                        local pedPos = GetEntityCoords(ped)

                        local dst = getdist(pedPos.x, x, pedPos.y, y)

                        if dst <= 10 then
                            DrawMarker(20, npcPos + vector3(0.0, 0.0, 1.15), 0, 0, 0, 0, 0, 0, 0.45, 0.45, -0.45, 169, 173, 115, 150, false, true)
                            
                            if dst <= 2 then
                                if not inputActive then
                                    inputActive = true
                                    TriggerEvent("vrp-hud:showBind", {key = "E", text = "Livreaza drogurile"})
                                end
    
                                if IsControlJustReleased(0, 38) and not IsPedInAnyVehicle(PlayerPedId(), true) then
                                    local deliver = promise.new()
                                    triggerCallback("hasItemAmount", function(hasOpium)
                                        if hasOpium then
                                            vRP.playAnim(false, {{"mp_common", "givetake1_a", 1}}, false, true)

                                            triggerCallback("getPaid", function()
                                                theJob = {
                                                    plants = deepcopy(theJob.plants),
                                                }
                                                TriggerServerEvent("jobs:updateLastJob", theJob)
                                                vRP.subtitle("~HC_93~Minunat! ~w~Ai livrat Opium clientului, asteapta urmatoarea locatie.")
                                            end, cpData, theJob.amount)
                                            inputActive = false
                                            TriggerEvent("vrp-hud:showBind", false)
                                            deliver:resolve(true)
                                        else
                                            deliver:resolve(false)
                                            TriggerEvent("vrp-hud:notify", "Nu ai destule droguri, clientul vrea "..theJob.amount.." Opium !", "error")
                                        end
                                    end, "opium", theJob.amount, true)

                                    if Citizen.Await(deliver) then
                                        npcWaiting = false
                                    end
                                end
                            elseif inputActive then
                                TriggerEvent("vrp-hud:showBind", false)
                                inputActive = false
                            end
                        end

                        Citizen.Wait(1)
                    end
                    
                elseif next(blips) then
                    for _, blipid in pairs(blips) do
                        RemoveBlip(blipid)
                    end
                    blips = {}
                end
                
                if not theJob.slot then
                    jobActive = false
                end
                
                Citizen.Wait(2000)
            end
            
            if next(blips) then
                for _, blipid in pairs(blips) do
                    RemoveBlip(blipid)
                end
                blips = {}
            end

            for k, object in pairs(objs) do
                DeleteEntity(object)
            end
            objs = {}
        end)
    end
end)

AddEventHandler("jobs:setLastJob", function(job, lastJob)
    if job == "Traficant de opium" then
        theJob = lastJob
    end
end)

local growInterval = 60000 * 2 -- 60.000 * 2 = 2 min

AddEventHandler("jobs:onJobSet", function(job)
    
    Citizen.Wait(500)

    if inJob == "Traficant de opium" then

        Citizen.CreateThread(function()
            local function drawArrow(coords, label)
                local onScreen, screenX, screenY = GetScreenCoordFromWorldCoord(coords[1], coords[2], coords[3])
                local icon_scale = 1.0
                local text_scale = 0.25
            
                RequestStreamedTextureDict("basejumping", false)
                DrawSprite("basejumping", "arrow_pointer", screenX, screenY - 0.015, 0.015 * icon_scale, 0.025 * icon_scale, 180.0, 140, 157, 133, 255)
            
                if label then
                    SetTextCentre(true)
                    SetTextScale(0.0, text_scale)
                    SetTextEntry("STRING")
                    AddTextComponentString(label)
                    DrawText(screenX, screenY)
                end
            end

            local function getdist(x1, x2, y1, y2)
                return math.sqrt((y2-y1)*(y2-y1) + (x2-x1)*(x2-x1))
            end

            Citizen.CreateThread(function()
                Citizen.Wait(5000)
                vRP.subtitle("Pamantul e numai bun pentru ~HC_20~cules opium~w~, vezi harta pentru locatie.")
            end)

            Citizen.CreateThread(function()
                Citizen.Wait(10000)
                
                local objHash = GetHashKey("prop_bzzz_gardenpack_poppy001")
                RequestModel(objHash)
                while not HasModelLoaded(objHash) do
                    Citizen.Wait(100)
                end

                for k, plant in pairs(theJob.plants or {}) do
                    local x, y, z = table.unpack(plant.position)

                    local prop = CreateObject(objHash, x, y, ((z-1.0)-(tonumber(plant.grow) or 0)), true, true, false)
                    FreezeEntityPosition(prop, true)
                    SetEntityCollision(prop, false, false)

                    plant.prop = prop
                    table.insert(objs, prop) -- safe remove
                end
            end)
            
            local input = false
            while inJob == "Traficant de opium" do
                local wtime = 500

                local ped = PlayerPedId()
                local pedPos = GetEntityCoords(ped)
                
                for k, plant in pairs(theJob.plants or {}) do
                    local x, y, z = table.unpack(plant.position)

                    local dst = getdist(pedPos.x, x, pedPos.y, y)

                    if dst <= 15 then
                        local state = false

                        if plant.completed then
                            while dst <= 1.0 and DoesEntityExist(plant.prop) do
                                drawArrow(plant.position, false)

                                if not input then
                                    input = true
                                    TriggerEvent("vrp-hud:showBind", {key = "E", text = "Culege planta"})
                                end

                                if IsControlJustReleased(0, 38) and not IsPedInAnyVehicle(PlayerPedId(), true) then
                                    
                                    RequestAnimDict("anim@amb@drug_field_workers@weeding@male_a@idles")
                                    while not HasAnimDictLoaded("anim@amb@drug_field_workers@weeding@male_a@idles") do
                                        Citizen.Wait(1) 
                                    end

                                    TaskPlayAnim(ped, "anim@amb@drug_field_workers@weeding@male_a@idles","idle_b", 1.5, 1.0, 0.3, 48, 0.2, 0, 0, 0)
                                    FreezeEntityPosition(ped, true)

                                    SendNUIMessage({job = "opiumgame"})
                                    local gameDone = promise.new()
                                    gameFinish = function()
                                        gameDone:resolve(true)
                                    end
                                    
                                    if Citizen.Await(gameDone) then
                                        triggerCallback("gatherOpiumPlant", function(gathered)
                                            if gathered then
                                                local plant = theJob.plants[k]
                                                plant.completed = false
                                                plant.grow = 5
                                                local x, y, z = table.unpack(plant.position)
                                                SetEntityCoords(plant.prop, x, y, (z-1.0)-tonumber(plant.grow))
                                                TriggerServerEvent("jobs:updateLastJob", theJob)
                                                TriggerEvent("vrp-hud:showBind", false)
                                                input = false
                                            end
                                        end, k)

                                        Citizen.Wait(1000)
                                        
                                        StopAnimTask(ped, "anim@amb@drug_field_workers@weeding@male_a@idles","idle_b", 1.5)
                                        FreezeEntityPosition(ped, false)
                                        break
                                    end
                                end

                                ped = PlayerPedId()
                                pedPos = GetEntityCoords(ped)
                                dst = getdist(pedPos.x, x, pedPos.y, y)
                                Citizen.Wait(1)
                            end
                            
                            if input then
                                TriggerEvent("vrp-hud:showBind", false)
                                input = false
                            end
                        end

                        wtime = 1
                    elseif input then
                        TriggerEvent("vrp-hud:showBind", false)
                        input = false
                    end
                end

                Citizen.Wait(wtime)
            end
        end)

        while inJob == "Traficant de opium" do
            for k, plant in pairs(theJob.plants or {}) do
                if (plant.grow or 0) > 0 then
                    plant.grow = plant.grow - 1
                    local x, y, z = table.unpack(plant.position)
                    SetEntityCoords(plant.prop, x, y, (z-1.0)-tonumber(plant.grow))

                    if plant.grow < 1 then
                        plant.completed = true
                    end
                end
            end
            TriggerServerEvent("jobs:updateLastJob", theJob)

            Citizen.Wait(growInterval)
        end
    end
end)

local wagonPositions <const> = {
    {862.95770263672,2965.2338867188,46.882255554199,310.0, type = "pack"},
    {1436.2003173828,-1488.7021484375,66.619323730469,73.0, type = "combine"}, 
}

AddEventHandler("jobs:onJobSet", function(job)
    
    Citizen.Wait(500)

    local function getdist(x1, x2, y1, y2)
        return math.sqrt((y2-y1)*(y2-y1) + (x2-x1)*(x2-x1))
    end

    local ped = PlayerPedId()
    local pedPos = GetEntityCoords(ped)

    local input = false

    while inJob == "Traficant de opium" do
        
        for k, v in pairs(wagonPositions) do
            local dst = getdist(pedPos.x, v[1], pedPos.y, v[2])
            
            while dst <= 10 do
                DrawMarker(20, v[1], v[2], v[3], 0, 0, 0, 0, 0, 0, 0.201, 0.201, 0.2001, 169, 173, 115, 200, 0, 0, 0, 1)
            
                if dst < 2 then

                    if not input then
                        input = true
                        TriggerEvent("vrp-hud:showBind", {key = "E", text = v.type == "combine" and "Prepara amestec de opium" or "Impacheteaza amestecul de opium"})
                    end

                    if IsControlJustReleased(0, 38) then
                        local response = promise.new()
                        if v.type == "combine" then
                            triggerCallback("combineOpiumSeeds", function(ok)
                                if ok then
                                    SetEntityCoords(ped, v[1], v[2], v[3]-1.0)
                                    SetEntityHeading(ped, v[4])
                                    
                                    RequestAnimDict("anim@amb@clubhouse@tutorial@bkr_tut_ig3@")
                                    while not HasAnimDictLoaded("anim@amb@clubhouse@tutorial@bkr_tut_ig3@") do
                                        Citizen.Wait(1) 
                                    end
        
                                    TaskPlayAnim(ped, "anim@amb@clubhouse@tutorial@bkr_tut_ig3@","machinic_loop_mechandplayer", 1.5, 1.0, 0.3, 48, 0.2, 0, 0, 0)
                                    FreezeEntityPosition(ped, true)
        
                                    TriggerEvent("vrp-hud:showBind", false)
        
                                    Citizen.CreateThread(function()
                                        local untilTime = GetGameTimer() + 3000
        
                                        while GetGameTimer() < untilTime do
                                            drawText("Ai inceput sa zdrobesti semintele de opium cu apa...", 0.5, 0.85, 0.4, 169, 173, 115)
                                            Citizen.Wait(1)
                                        end
                                    end)
        
                                    Citizen.Wait(13000)
                                    
                                    StopAnimTask(ped, "anim@amb@clubhouse@tutorial@bkr_tut_ig3@","machinic_loop_mechandplayer", 1.5)
                                    FreezeEntityPosition(ped, false)
                                    input = false
                                    response:resolve(true)
                                else
                                    response:resolve(false)
                                end
                            end)
                        else
                            triggerCallback("packOpiumMixture", function(canPack)
                                if canPack then
                                    SetEntityCoords(ped, v[1], v[2], v[3]-1.0)
                                    SetEntityHeading(ped, v[4])
                                    
                                    RequestAnimDict("anim@amb@clubhouse@tutorial@bkr_tut_ig3@")
                                    while not HasAnimDictLoaded("anim@amb@clubhouse@tutorial@bkr_tut_ig3@") do
                                        Citizen.Wait(1) 
                                    end

                                    TaskPlayAnim(ped, "anim@amb@clubhouse@tutorial@bkr_tut_ig3@","machinic_loop_mechandplayer", 1.5, 1.0, 0.3, 48, 0.2, 0, 0, 0)
                                    FreezeEntityPosition(ped, true)

                                    TriggerEvent("vrp-hud:showBind", false)

                                    Citizen.CreateThread(function()
                                        local untilTime = GetGameTimer() + 3000

                                        while GetGameTimer() < untilTime do
                                            drawText("Ai inceput sa impachetezi amestecul...", 0.5, 0.85, 0.4, 169, 173, 115)
                                            Citizen.Wait(1)
                                        end
                                    end)

                                    Citizen.Wait(6000)
                                    
                                    StopAnimTask(ped, "anim@amb@clubhouse@tutorial@bkr_tut_ig3@","machinic_loop_mechandplayer", 1.5)
                                    FreezeEntityPosition(ped, false)

                                    input = false
                                    response:resolve(true)
                                else
                                    response:resolve(false)
                                end
                            end)
                        end
                        Citizen.Await(response)
                    end

                elseif input then
                    TriggerEvent("vrp-hud:showBind", false)
                    input = false
                end

                ped = PlayerPedId()
                pedPos = GetEntityCoords(ped)
                dst = getdist(pedPos.x, v[1], pedPos.y, v[2])
                Citizen.Wait(1)
            end

            if input then
                TriggerEvent("vrp-hud:showBind", false)
                input = false
            end
        end

        ped = PlayerPedId()
        pedPos = GetEntityCoords(ped)
        Citizen.Wait(1000)
    end
end)

local resName = GetCurrentResourceName()
AddEventHandler("onResourceStop", function(res)
    if res == resName then
        for k, object in pairs(objs) do
            DeleteEntity(object)
        end
        objs = {}
    end
end)

